<div
  class="lib-table-container"
  [class.lib-table--hoverable]="hoverable()"
  [class.lib-table--striped]="striped()"
  [class.lib-table--compact]="density() === 'compact'"
  [class.lib-table--comfortable]="density() === 'comfortable'"
>
  <!-- Loading State -->
  @if (isLoading()) {
    @if (loadingTemplate()) {
      <ng-container *ngTemplateOutlet="loadingTemplate()!"></ng-container>
    } @else {
      <div class="lib-table-loading">
        <div class="lib-table-spinner"></div>
        <span>Loading...</span>
      </div>
    }
  } @else {
    <table class="lib-table">
      <!-- Header -->
      <thead class="lib-table-header">
        <tr>
          @if (columnDefs().length > 0) {
            <!-- Declarative columns -->
            @for (col of columnDefs(); track col.name()) {
              <th
                class="lib-table-header-cell"
                [style.width]="col.width()"
                [class.lib-table-header-cell--sortable]="col.sortable()"
              >
                @if (col.headerTemplate()) {
                  <ng-container *ngTemplateOutlet="col.headerTemplate()!"></ng-container>
                } @else {
                  {{ col.name() }}
                }
              </th>
            }
          } @else {
            <!-- Legacy header projection -->
            <ng-content select="[tableHeader]"></ng-content>
          }
        </tr>
      </thead>

      <!-- Body -->
      <tbody class="lib-table-body">
        @if (isEmpty()) {
          <!-- Empty State -->
          <tr class="lib-table-empty-row">
            <td [attr.colspan]="columnDefs().length || 1">
              @if (emptyTemplate()) {
                <ng-container *ngTemplateOutlet="emptyTemplate()!"></ng-container>
              } @else {
                <div class="lib-table-empty">{{ emptyMessage() }}</div>
              }
            </td>
          </tr>
        } @else {
          <!-- Data Rows -->
          @for (item of data(); track getTrackBy()($index, item); let i = $index) {
            <tr
              class="lib-table-row"
              [class.lib-table-row--even]="i % 2 === 0"
              [class.lib-table-row--odd]="i % 2 !== 0"
              (click)="onRowClick(item, i)"
            >
              @if (columnDefs().length > 0) {
                <!-- Declarative columns -->
                @for (col of columnDefs(); track col.name()) {
                  <td class="lib-table-cell" [class]="col.cellClass()">
                    @if (col.cellTemplate()) {
                      <ng-container
                        *ngTemplateOutlet="col.cellTemplate()!; context: getRowContext(item, i)"
                      ></ng-container>
                    } @else {
                      {{ $any(item)[col.name()] }}
                    }
                  </td>
                }
              } @else if (rowTemplate()) {
                <!-- Legacy row template -->
                <ng-container
                  *ngTemplateOutlet="rowTemplate()!; context: getRowContext(item, i)"
                ></ng-container>
              }
            </tr>
          }
        }
      </tbody>
    </table>
  }
</div>
