<!-- Trigger Button -->
<button
  type="button"
  class="lib-select__trigger"
  (click)="onTriggerClick()"
  [attr.aria-haspopup]="'listbox'"
  [attr.aria-expanded]="isOpen()"
  [disabled]="disabled() || loading()"
>
  <!-- Multi-select chips -->
  @if (multiple() && selectedValues().length > 0) {
    <div class="lib-select__chips">
      @for (val of selectedValues(); track trackByValue($index, val)) {
        <span class="lib-select__chip">
          <span class="lib-select__chip-label">{{ getChipLabel(val) }}</span>
          <button
            type="button"
            class="lib-select__chip-remove"
            (click)="removeValue(val, $event)"
            aria-label="Remove"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              />
            </svg>
          </button>
        </span>
      }
    </div>
  } @else {
    <!-- Single value display or placeholder -->
    <span class="lib-select__value" [class.lib-select__placeholder]="!hasValue()">
      {{ hasValue() ? displayLabel() : placeholder() }}
    </span>
  }

  <!-- Icons container -->
  <div class="lib-select__icons">
    <!-- Loading spinner -->
    @if (loading()) {
      <div class="lib-select__spinner"></div>
    }

    <!-- Clear button -->
    @if (clearable() && hasValue() && !disabled() && !loading()) {
      <button
        type="button"
        class="lib-select__clear"
        (click)="clear($event)"
        aria-label="Clear selection"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
          />
        </svg>
      </button>
    }

    <!-- Dropdown arrow -->
    @if (!loading()) {
      <svg class="lib-select__arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 10l5 5 5-5z" />
      </svg>
    }
  </div>
</button>

<!-- Dropdown Panel -->
@if (isOpen() && !loading()) {
  <div
    class="lib-select__panel"
    role="listbox"
    [id]="listboxId"
    [attr.aria-multiselectable]="multiple()"
    [attr.aria-label]="placeholder()"
    (mouseleave)="onPanelMouseLeave()"
  >
    <!-- Search input -->
    @if (searchable()) {
      <div class="lib-select__search">
        <svg
          class="lib-select__search-icon"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="currentColor"
        >
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <input
          #searchInput
          type="text"
          class="lib-select__search-input"
          [placeholder]="searchPlaceholder()"
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          autocomplete="off"
        />
      </div>
    }

    <!-- Options list -->
    <div class="lib-select__options">
      @if (visibleOptionsCount() === 0) {
        <div class="lib-select__empty">No options found</div>
      }
      <ng-content />
    </div>
  </div>
}
